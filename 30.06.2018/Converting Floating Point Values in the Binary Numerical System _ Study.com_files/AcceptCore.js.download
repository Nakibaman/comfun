!function(a){"use strict";function b(a,b){if("undefined"!=typeof isReady&&isReady)if(void 0===a||void 0===a.cardData&&void 0===a.bankData||void 0===a.authData||void 0===b)l("E_WC_04",C.messageInfo.E_WC_04);else if(a.cardData&&a.bankData)l("E_WC_23",C.messageInfo.E_WC_23);else{p(a),a.cardData?(j(a),o(a),n(a),h(a.cardData)):(c(a.bankData),d(a.bankData),e(a.bankData),f(a.bankData));do{if(void 0!==a.authData.clientKey&&0===a.authData.clientKey.length)l("E_WC_18",C.messageInfo.E_WC_18);else{if(void 0!==a.authData.clientKey)break;void 0!==a.authData.fingerprint?g(a.authData.fingerprint):l("E_WC_18",C.messageInfo.E_WC_18)}}while(!1)}else l("E_WC_14",C.messageInfo.E_WC_14)}function c(a){var b=a.accountType?a.accountType.replace(/[\. ,:-]+/g,""):"",c=String(b).toLowerCase();if("checking"===c)a.accountType="checking";else if("savings"===c)a.accountType="savings";else{if("businesschecking"!==c)return void l("E_WC_27",C.messageInfo.E_WC_27);a.accountType="businessChecking"}}function d(a){var b=a.routingNumber?a.routingNumber.replace(/[\. ,:-]+/g,""):"";if(!/^[0-9]{0,9}$/.exec(b))return void l("E_WC_25",C.messageInfo.E_WC_25);a.routingNumber=b}function e(a){var b=a.accountNumber?a.accountNumber.replace(/[\. ,:-]+/g,""):"";if(!/^[0-9]{5,17}$/.exec(b))return void l("E_WC_24",C.messageInfo.E_WC_24);a.accountNumber=b}function f(a){var b=a.nameOnAccount?a.nameOnAccount:"";if(!/^[a-zA-Z0-9(). #,]{0,22}$/.exec(b))return void l("E_WC_26",C.messageInfo.E_WC_26);a.nameOnAccount=b}function g(a){var b={timestamp:"E_WC_11",sequence:"E_WC_12",hashValue:"E_WC_09",amount:"E_WC_13"};for(var c in b)(!1===a.hasOwnProperty(c)||a[c].length<=0)&&l(b[c],C.messageInfo[b[c]])}function h(a){var b={cardCode:{errorCode:"E_WC_15",regex:"^([0-9]{3,4})$"},zip:{errorCode:"E_WC_16",regex:"^.{1,20}$"},fullName:{errorCode:"E_WC_17",regex:"^.{1,64}$"}};for(var c in b)if(a.hasOwnProperty(c)&&0!==a[c].length){var d=new RegExp(b[c].regex,"g");a[c].match(d)||l(b[c].errorCode,C.messageInfo[b[c].errorCode])}}function i(){var a="E_WC_02",b="E_WC_01",c=A+"Accept.js";0!==document.querySelectorAll('script[src="'+c+'"]').length||k(z,b)||(y.warn("Library is not coming from Accept CDN."),m(b,C.messageInfo.E_WC_01)),"https:"===window.location.protocol||k(z,a)||(y.warn("An HTTPs connection is required to secure delivery of payment information."),m(a,C.messageInfo.E_WC_02))}function j(a){var b=void 0!==a.cardData.cardNumber?a.cardData.cardNumber.replace(/[\. ,:-]+/g,""):"";if(!/^[0-9]{13,16}$/.exec(b))return void l("E_WC_05",C.messageInfo.E_WC_05);var c=0,d=0,e=!1;b=b.replace(/\D/g,"");for(var f=b.length-1;f>=0;f--){var g=b.charAt(f);d=parseInt(g,10),e&&(d*=2)>9&&(d-=9),c+=d,e=!e}return c%10!=0?void l("E_WC_05",C.messageInfo.E_WC_05):void 0}function k(a,b){for(var c=a.length;c--;)if(a[c].code==b)return!0;return!1}function l(a,b){x.messages.resultCode="Error",x.messages.message.push({code:a,text:b})}function m(a,b){z.push({code:a,text:b})}function n(a){var b;void 0!==a.cardData.month&&(b=1===a.cardData.month.length?"0"+a.cardData.month:a.cardData.month,a.cardData.month=b);var c=/^(0[1-9]|1[012])$/;if(void 0===b||!c.exec(b))return void l("E_WC_06",C.messageInfo.E_WC_06)}function o(a){var b,c,d=/\b([0-9]{2}(?:[0-9]{2})?)\b/,e=/^(0[1-9]|1[012])$/;if(void 0!==a.cardData.month&&(c=1===a.cardData.month.length?"0"+a.cardData.month:a.cardData.month),void 0!==a.cardData.year&&(b=a.cardData.year),void 0===b||!d.exec(b))return void l("E_WC_07",C.messageInfo.E_WC_07);if(void 0!==c&&e.exec(c)){var f,g;if(f=new Date,b=2==b.length?20+b:b,g=new Date(b,c,0),g.setHours(23,59,59,999),g<f)return void l("E_WC_08",C.messageInfo.E_WC_08)}}function p(a){a.authData.hasOwnProperty("apiLoginID")&&void 0!==a.authData.apiLoginID&&0!==a.authData.apiLoginID.length&&a.authData.apiLoginID.length<255||l("E_WC_10",C.messageInfo.E_WC_10)}function q(a){var b={0:{key:"cardCode"},1:{key:"zip"},2:{key:"fullName"}};try{var c={type:"TOKEN",id:(new D).newGuid(),token:{cardNumber:a.cardData.cardNumber,expirationDate:a.cardData.month+a.cardData.year}};for(var d in b)a.cardData.hasOwnProperty(b[d].key)&&a.cardData[b[d].key].length>0&&(c.token[b[d].key]=a.cardData[b[d].key]);return c}catch(e){throw y.log("AcceptCore:constructCardData:"+e.message),{code:"E_WC_14",text:C.messageInfo.E_WC_14}}}function r(a){try{return{type:"TOKEN",id:(new D).newGuid(),bankToken:{accountType:a.bankData.accountType,routingNumber:a.bankData.routingNumber,accountNumber:a.bankData.accountNumber,nameOnAccount:a.bankData.nameOnAccount}}}catch(b){throw y.log("AcceptCore:constructBankData:"+b.message),{code:"E_WC_14",text:C.messageInfo.E_WC_14}}}function s(a,b){try{var c=JSON.parse(a.responseText);if(void 0!==c.messages.resultCode&&void 0!==c.messages.message&&c.messages.message.length>=1){for(var d in c.messages.message)switch(c.messages.message[d].code){case"I00001":c.messages.message[d].code="I_WC_01";break;case"E00001":c.messages.message[d].code="E_WC_19";break;case"E00003":c.messages.message[d].code="E_WC_20";break;case"E00007":c.messages.message[d].code="E_WC_21";break;case"E00059":c.messages.message[d].code="E_WC_22";break;case"E00096":c.messages.message[d].code="E_WC_13"}u(c,b)}else x.messages.resultCode="Error",l("E_WC_14",C.messageInfo.E_WC_14),u(x,b)}catch(e){x.messages.resultCode="Error",l("E_WC_14",C.messageInfo.E_WC_14),u(x,b)}}function t(a,b){var c=null,d=B+"/xml/v1/request.api";c="undefined"!=typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest,c.open("post",d,!0),"undefined"==typeof XDomainRequest&&c.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.onload=function(){setTimeout(function(){s(c,b)})};var e={securePaymentContainerRequest:{merchantAuthentication:{name:a.authData.apiLoginID}}};a.hasOwnProperty("clientId")&&(e.securePaymentContainerRequest.clientId=a.clientId),e.securePaymentContainerRequest.data=a.cardData?q(a):r(a),a.authData.hasOwnProperty("clientKey")?e.securePaymentContainerRequest.merchantAuthentication.clientKey=a.authData.clientKey:e.securePaymentContainerRequest.merchantAuthentication.fingerPrint={hashValue:a.authData.fingerprint.hashValue,sequence:a.authData.fingerprint.sequence,timestamp:a.authData.fingerprint.timestamp,amount:a.authData.fingerprint.amount},c.send(JSON.stringify(e))}function u(a,b){"function"==typeof b?b.call(null,a):window[b](a)}function v(){var a=document.createEvent("Event");a.initEvent("handshake",!0,!0),document.getElementsByTagName("body")[0].dispatchEvent(a)}function w(){v(),i()}var x={messages:{resultCode:"Ok",message:[]}},y=window.console||{warn:function(){},log:function(){}},z=[],A=window.cdnPath,B=window.encryptEndPoint,C=function(){return{messageInfo:{E_WC_01:"Please include Accept.js library from cdn.",E_WC_02:"A HTTPS connection is required.",E_WC_03:"Accept.js is not loaded correctly.",E_WC_04:"Please provide mandatory field to library.",E_WC_05:"Please provide valid credit card number.",E_WC_06:"Please provide valid expiration month.",E_WC_07:"Please provide valid expiration year.",E_WC_08:"Expiration date must be in the future.",E_WC_09:"Fingerprint hash should not be blank.",E_WC_10:"Please provide valid apiloginid.",E_WC_11:"Please provide valid timestamp in utc.",E_WC_12:"Sequence attribute should not be blank.",E_WC_13:"Invalid Fingerprint.",E_WC_14:"Accept.js encryption failed.",E_WC_15:"Please provide valid CVV.",E_WC_16:"Please provide valid Zip code.",E_WC_17:"Please provide valid card holder name.",E_WC_18:"Client key is required.",E_WC_19:"An error occurred during processing. Please try again.",E_WC_20:"An error occurred while parsing the XML request.",E_WC_21:"User authentication failed due to invalid authentication values.",E_WC_22:"The authentication type is not allowed for this method call.",E_WC_23:"Please provide either card information or bank information.",E_WC_24:"Please provide valid account number.",E_WC_25:"Please provide valid routing number.",E_WC_26:"Please provide valid account holder name.",E_WC_27:"Please provide valid account type."}}}();"function"==typeof a.dispatchData&&(a.dispatchData=function(a,c){if(x={messages:{resultCode:"Ok",message:[]}},z.length>0)x={messages:{resultCode:"Error",message:z}},u(x,c);else if(b(a,c),"Ok"===x.messages.resultCode)try{t(a,c)}catch(d){l("E_WC_14",C.messageInfo.E_WC_14),u(x,c)}else u(x,c)});var D=function(){var a=function(b,c,d){return b.length>=c?b:a(d+b,c,d||" ")},b=function(b){var c=b.toString(16);return a(c,4,"0")},c=function(){var a=new window.Uint16Array(8);return window.crypto.getRandomValues(a),[b(a[0])+b(a[1]),b(a[2]),b(a[3]),b(a[4]),b(a[5])+b(a[6])+b(a[7])].join("-")},d=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:7&c|8).toString(16)})};return{newGuid:function(){return void 0!==window.crypto&&void 0!==window.crypto.getRandomValues?c():d()}}};"complete"===document.readyState?w():window.addEventListener?window.addEventListener("load",w,!1):window.attachEvent?window.attachEvent("onload",w):window.onLoad&&(window.onload=w)}(Accept);
